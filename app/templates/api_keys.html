{% extends "base.html" %}

{% block title %}API Keys - Snippet Manager{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">API Keys</h1>

    <!-- Create API Key Form -->
    <div class="bg-white shadow rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">Create New API Key</h2>
        <form action="/api-keys" method="POST" class="space-y-4">
            <div>
                <label for="name" class="block text-sm font-medium text-gray-700">Key Name</label>
                <input type="text" name="name" id="name" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <button type="submit"
                class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Create API Key
            </button>
        </form>
    </div>

    <!-- API Keys List -->
    <div class="bg-white shadow rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">Your API Keys</h2>
        {% if api_key %}
        <!-- Newly Created Key -->
        <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <h3 class="text-lg font-medium text-green-800 mb-2">New API Key Created</h3>
            <p class="text-sm text-gray-600 mb-2">Make sure to copy your API key now. You won't be able to see it again!</p>
            <div class="flex items-center space-x-2">
                <code class="flex-1 p-2 bg-white border border-green-200 rounded" id="new-api-key">{{ api_key }}</code>
                <button onclick="copyToClipboard('new-api-key')"
                    class="px-3 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                    Copy
                </button>
            </div>
        </div>
        {% endif %}

        {% if api_keys %}
        <div class="space-y-4">
            {% for key in api_keys %}
            <div class="border rounded-lg p-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-medium">{{ key.name }}</h3>
                        <p class="text-sm text-gray-500">Created: {{ key.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                        <p class="text-sm text-gray-500">Last used: {{ key.last_used.strftime('%Y-%m-%d %H:%M:%S') if key.last_used else 'Never' }}</p>
                    </div>
                    <form action="/api-keys/{{ key.id }}/revoke" method="POST" class="inline">
                        <button type="submit"
                            class="px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
                            onclick="return confirm('Are you sure you want to revoke this API key?')">
                            Revoke
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-500">You haven't created any API keys yet.</p>
        {% endif %}
    </div>
</div>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.textContent;
    navigator.clipboard.writeText(text).then(() => {
        // Visual feedback
        element.classList.add('bg-green-50');
        setTimeout(() => {
            element.classList.remove('bg-green-50');
        }, 200);
    });
}
</script>
{% endblock %}
